# Расширения

(vscode-jest)[https://github.com/jest-community/vscode-jest] - расширение для Visual Studio для работы с тестами

# Запуск Тестов

Тесты запускаются командой
```
npm run test
```

Скрит прописан в `package.json`
```
  "scripts": {
    "test": "react-scripts test --coverage"
  },
```

Параметры:
`--coverage` - анализ покрытия компонентов тестами


# React Testing Library
*React Testing Library* строится поверх библиотеки тестирования DOM, добавляя API для работы с компонентами React

```
npm i -D @testing-library/react
```

[Предоставляемые методы](https://testing-library.com/docs/react-testing-library/api):
- [render](https://testing-library.com/docs/react-testing-library/api#render-result) - метод, который выполняет рендер элмента

[Queries](https://testing-library.com/docs/queries/about/) - это методы, которые предоставляет библиотека тестирования для поиска элементов на странице

[Типы запросов](https://testing-library.com/docs/queries/about/#types-of-queries):
- Поиск одного элемента
  - `getBy...` - возвращает соответствующий запросу элемент и выдает ошибку, если нет совпадающих элементов или если найдено более одного совпадения
  - `queryBy...` - возвращает соответствующий запросe элемент или null. Это полезно для утверждения элемента, которого нет. Выдает ошибку, если найдено более одного совпадения.
  - `findBy...` - возвращает промис, который разрешается, когда найден элемент, соответствующий заданному запросу. Промис отклоняется, если элемент не найден или если найдено более одного элемента после тайм-аута (*по умолчанию 1000 мс*)
- Поиск нескольких элементов
  - `getAllBy...` - возвращает массив всех соответствующий запросу элементов и выдает ошибку, если нет совпадающих элементов
  - `queryAllBy...` - возвращает массив всех соответствующий запросу элементов и возвращает пустой массив, если нет совпадающих элементов.
  - `findAllBy...` - возвращает промис, которое разрешается в массив элементов, когда найдены какие-либо элементы, соответствующие заданному запросу. Промис отклоняется, если элементы не найдены после таймаута (*по умолчанию 1000 мс*)
    - Методы findBy представляют собой комбинацию запросов getBy* и waitFor. Они принимают опции waitFor в качестве последнего аргумента (т.е. await screen.findByText('text', queryOptions, waitForOptions))

[Приоритет поисковых функций](https://testing-library.com/docs/queries/about#priority)
Согласно Руководящим принципам, тест должен максимально напоминать то, как пользователи взаимодействуют с вашим кодом (компонентом, страницей и т. д.). В связи с чем рекомендуется следующий порядок приоритета поисковых функций:

1. **Запросы, доступные для всех** - Запросы, отражающие опыт пользователей визуальных средств/мыши, а также тех, кто использует вспомогательные технологии 
    - `getByRole` - это можно использовать для запроса элемента по его [роли](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques#roles). С опцией `name` можно фильтровать возвращаемые элементы по имени (`getByRole('button', {name: /submit/i}`)
    - `getByLabelText` - чаще использутся для полей формы. При навигации по форме веб-сайта пользователи находят элементы с помощью текста лейбл. Этот метод эмулирует это поведение
    - `getByPlaceholderText` - используется для форм, если отсутсвует лейбл
    - `getByText` - текстовое содержимое является основным способом поиска элементов пользователями. Этот метод можно использовать для поиска неинтерактивных элементов (таких как `div`, `span` и `p`)
    - `getByDisplayValue` - текущее значение элемента формы может быть полезно при навигации по странице с заполненными значениями.
1. **Семантические запросы** HTML5 и ARIA-совместимые селекторы - *Обратите внимание, что пользовательский опыт взаимодействия с этими атрибутами сильно различается в зависимости от браузера и вспомогательных технологий*
    - `getByAltText` - если ваш элемент поддерживает альтернативный текст (`img`, `aria`, `input` и любой кастомный элемент)
    - `getByTitle` - атрибут `title` не всегда читается программами чтения с экрана и по умолчанию невидим для зрячих пользователей
1. **Идентификаторы тестов**
    - `getByTestId` - пользователь не может видеть (или слышать) их, поэтому это рекомендуется только в тех случаях, когда вы не можете сопоставить роль или текст или это не имеет смысла (например, текст является динамическим)

### jest-dom

Может работать с любой библиотекой или фреймворком, которые возвращают элементы DOM из запросов

```
npm i -D @testing-library/jest-dom
```

[Пример использование](https://testing-library.com/docs/ecosystem-jest-dom)
[Предоставляемые методы](https://github.com/testing-library/jest-dom)


### user-event

Cопутствующая библиотека для Testing Library, которая обеспечивает продвинутое моделирование взаимодействий с браузером

```
npm i -D @testing-library/user-event
```

[Документация](https://testing-library.com/docs/ecosystem-user-event/)


### Mock

[Mock-функции](https://jestjs.io/ru/docs/mock-functions) позволяют тестировать связи между кодом, удаляя фактическую реализацию функции, перехватывая вызовы функции (и параметры, передаваемые в этих вызовах), перехватывая экземпляры функций-конструкторов при создании экземпляра с помощью new и разрешая настройку во время тестирования возвращаемых значений.

Мок компонента
```
jest.mock('./SomeComponent', () => () => 'SomeComponent');
```
